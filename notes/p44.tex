\input{euler.tex}

\begin{document}

\problem[44]{Sum and Difference of Pentagonal Numbers}

Pentagonal numbers are generated by the formula $P_n=n(3n-1)/2$. The first ten pentagonal numbers are: 
1, 5, 12, 22, 35, 51, 70, 92, 117, 145.
 
It can be seen that $P_4 + P_7 = 22 + 70 = 92 = P_8$. However, their difference, $70 - 22 = 48$, is not pentagonal.
 
Find the pair of pentagonal numbers, $P_j$ and $P_k$, for which their sum and difference is pentagonal and $D = |P_k - P_j|$ is minimized. What is the value of $D$?

\solution

It is interesting to generalize the problem to polygonal numbers of higher rank. The $n$th polygonal number of rank $r$ is defined by
\begin{equation}
P_n^{(r)} = \frac12 n[(r-2)n - (r-4)] . \label{eq:44.0}
\end{equation}
% For reason to be seen later, we can write $P_n$ in the following equivalent form
% \[
% P_n = \frac{[2(r-2)n - (r-4)]^2 - (r-4)^2}{8(r-2)} .
% \]

Without loss of generality, suppose $P_j > P_k$ and denote their sum by $P_l$ and their difference by $P_i$. Then we get the following equations
\begin{align}
P_j + P_k &= P_l \label{eq:44.1}  \\
P_j - P_k &= P_i \label{eq:44.2}  
\end{align}
Since we need to find the pair with the smallest difference, we start by examining $D = P_i$. Substituting \eqref{eq:44.0} into \eqref{eq:44.2} and rearranging terms, we get
\begin{equation}
(j-k)[(r-2)(j+k)-(r-4)] = i[(r-2)i-(r-4)] . \label{eq:44.5}
\end{equation}
This is a second order Diophantine equation involving three unknowns, which is not obvious to solve. Therefore, we employ a semi-brute-force approach. For each pair of divisors $(a, b)$ of the right hand side of \eqref{eq:44.5} such that $a \le b$ and $ab =  i[(r-2)i-(r-4)]$, solve the following equation for $j, k$:
\begin{align}
a &= j-k \label{eq:44.7} \\
b &= (r-2)(j+k)-(r-4) \label{eq:44.8} 
\end{align}
which yields
\begin{equation}
j = \frac12 \left[\frac{b+(r-4)}{r-2}+a\right],  
k = \frac12 \left[\frac{b+(r-4)}{r-2}-a\right] . \label{eq:44.9}
\end{equation}
Note that it is safe to assume the order of the equations \eqref{eq:44.7} and \eqref{eq:44.8} because
\[
(r-2)(j+k)-(r-4) \ge (r-2)(j+1)-(r-4) = (r-2)j+2 \ge j+2 > j-k .
\]

If $j$ and $k$ in equation \eqref{eq:44.9} are both positive integers, then substitute it back into equation \eqref{eq:44.1} to check whether $l$ can be solved. If it can, then we have found the solution.

%To enumerate the divisors of $i[(r-2)i-(r-4)]$ efficiently, we first factorize the number. Since it's a product of two terms, each term can be factorized independently. Also note that if a prime $p$ is a common factor of $i$ and $[(r-2)i-(r-4)]$, then $p$ must divide $(r-4)$. Therefore $p$ divides $\gcd(i,r-4)$.

% \[
% x = (a+b)/2, y = (b-a)/2
% \]
% and check whether $z^2 = x^2+y^2-(r-4)^2$ is a perfect square and $x$, $y$, $z$ are equal to $(4-r)$ modulo $2(r-2)$. If all conditions are met, then $(x,y,z,w)$ is the solution we are looking for.


% Now make use of the rewritten form of $P_n$, and let
% \begin{align}
% w &= 2(r-2)i - (r-4) \notag \\
% x &= 2(r-2)j - (r-4) \notag \\
% y &= 2(r-2)k - (r-4) \notag \\
% z &= 2(r-2)l - (r-4) . \notag
% \end{align}
% Substituting these into equations \eqref{eq:44.1} and \eqref{eq:44.2} and rearranging terms, we get
% \begin{align}
% x^2 + y^2 &= z^2 + (r-4)^2 \label{eq:44.3} \\
% x^2 - y^2 &= w^2 - (r-4)^2 \label{eq:44.4}
% \end{align}
% So the set of solutions to the original problem corresponds to the subset of solutions to this neat system where $2(r-2)$ divides $w+(r-4)$, etc.

% What's good about this parameterization is that increasing $w$ corresponds to increasing $D = |P_j - P_k|$, so to minimize $D$ we just need to enumerate $w$ starting from the smallest value, and stop when we find the first set of solutions.

% To solve equations \eqref{eq:44.3} and \eqref{eq:44.4}, factorize equation \eqref{eq:44.4} as
% \[
% (x+y)(x-y) = [w+(r-4)][w-(r-4)] .
% \]
% For each pair of divisors $(a, b)$ of the right hand side where $a < b$ and $ab = w^2 - (r-4)^2$, let
% \[
% x = (a+b)/2, y = (b-a)/2
% \]
% and check whether $z^2 = x^2+y^2-(r-4)^2$ is a perfect square and $x$, $y$, $z$ are equal to $(4-r)$ modulo $2(r-2)$. If all conditions are met, then $(x,y,z,w)$ is the solution we are looking for.

\complexity

Let $n$ be the index of the polygonal number that minimizes the difference, i.e. $D = P_n$. Then we would have made $n$ iterations to solve equation \eqref{eq:44.5}. In each iteration, we first factorize the two terms in $i[(r-2)i-(r-4)]$ separately, which takes $\BigO(\sqrt{n})$ number of trial divisions. Generating the divisor pairs takes $\BigO(n)$ time and there are no more than $\BigO(n)$ pairs of divisors. For each pair, it takes $O(1)$ time to test the other equations.

Time complexity: $\BigO(n^2)$.

Space complexity: $\BigO(\ln n)$.

\answer

5482660

\reference

http://mathworld.wolfram.com/PolygonalNumber.html

http://en.wikipedia.org/wiki/Polygonal\_number

\end{document} 